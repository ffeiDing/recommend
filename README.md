# recommend

## 数据

### 数据1：loan.xlsx
id   jsonb    creation_date    created_by

jsonb
{"id": "3fd2d7aa-a6fe-4794-9d34-837a6bd31a8b", "action": "holdrequested", "itemId": "bb5a6689-c008-4c96-8f8f-b666850ee12d", "status": {"name": "Open"}, "userId": "ab579dc3-219b-4f5b-8068-ab1c7a55c402", "dueDate": "2017-01-19T12:42:21.000+00:00", "loanDate": "2017-01-05T12:42:21Z", "metadata": {"createdDate": "2020-12-10T02:00:40.411", "updatedDate": "2020-12-10T02:00:40.411+00:00"}, "itemStatus": "Checked out"}

{"id": "93760135-5e92-49ea-9e65-9dcb6cecdeb8", "action": "checkedin", "itemId": "3b1af95b-b843-4ad1-b2d7-b6475f042241", "status": {"name": "Closed"}, "userId": "4a7c1ceb-0e26-4a24-ad4f-f782587cb49f", "dueDate": "2020-04-18T15:59:00.000+00:00", "loanDate": "2019-11-09T05:35:06Z", "metadata": {"createdDate": "2021-01-14T12:40:13.834", "updatedDate": "2021-01-24T19:08:38.559+00:00", "createdByUserId": "7069a7b0-36e7-4f9d-bc42-2d0640ab268d", "updatedByUserId": "7069a7b0-36e7-4f9d-bc42-2d0640ab268d"}, "itemStatus": "Available", "returnDate": "2021-01-24T19:09:57.000Z", "loanPolicyId": "c33e4b9f-0937-4d29-a848-cfa3e446bd04", "lostItemPolicyId": "be4173d0-fbf4-4bfa-9458-fa8fbd34ed7a", "systemReturnDate": "2021-01-24T19:08:37.530+00:00", "overdueFinePolicyId": "3cbc29f2-0e55-4499-a3a7-06de026ba75d", "checkinServicePointId": "3a40852d-49fd-4df2-a1f9-6e2641a6e91f", "checkoutServicePointId": "3a40852d-49fd-4df2-a1f9-6e2641a6e91f", "patronGroupIdAtCheckout": "1d65b61d-6dba-4769-bb7e-651a874f7004", "itemEffectiveLocationIdAtCheckOut": "6f016e6b-cdd9-4047-b941-90515af8636c"}

{"id": "a5b8e65f-2f98-4083-9e6e-40cd6e07c06f", "action": "checkedin", "itemId": "867203d9-ab49-4cc4-8ac8-a33f582e2c0b", "status": {"name": "Closed"}, "userId": "4a7c1ceb-0e26-4a24-ad4f-f782587cb49f", "dueDate": "2020-04-18T15:59:00.000+00:00", "loanDate": "2019-11-09T05:34:47Z", "metadata": {"createdDate": "2021-01-14T12:40:12.275", "updatedDate": "2021-01-24T19:08:34.814+00:00", "createdByUserId": "7069a7b0-36e7-4f9d-bc42-2d0640ab268d", "updatedByUserId": "7069a7b0-36e7-4f9d-bc42-2d0640ab268d"}, "itemStatus": "Available", "returnDate": "2021-01-24T19:09:53.000Z", "loanPolicyId": "c33e4b9f-0937-4d29-a848-cfa3e446bd04", "lostItemPolicyId": "be4173d0-fbf4-4bfa-9458-fa8fbd34ed7a", "systemReturnDate": "2021-01-24T19:08:34.100+00:00", "overdueFinePolicyId": "3cbc29f2-0e55-4499-a3a7-06de026ba75d", "checkinServicePointId": "3a40852d-49fd-4df2-a1f9-6e2641a6e91f", "checkoutServicePointId": "3a40852d-49fd-4df2-a1f9-6e2641a6e91f", "patronGroupIdAtCheckout": "1d65b61d-6dba-4769-bb7e-651a874f7004", "itemEffectiveLocationIdAtCheckOut": "6f016e6b-cdd9-4047-b941-90515af8636c"}

{"id": "848167c7-d7b6-4829-9839-0854c2eff132", "action": "checkedin", "itemId": "867203d9-ab49-4cc4-8ac8-a33f582e2c0b", "status": {"name": "Closed"}, "userId": "5c55422b-0ece-49de-a2ae-15f32dbd571d", "dueDate": "2021-04-13T15:59:00.000+00:00", "loanDate": "2021-03-13T13:55:35Z", "metadata": {"createdDate": "2021-03-13T22:20:22.002", "updatedDate": "2021-04-03T00:03:02.922+00:00", "createdByUserId": "7069a7b0-36e7-4f9d-bc42-2d0640ab268d", "updatedByUserId": "071e6b81-5b8f-4130-a5c2-98840953eb6c"}, "itemStatus": "Available", "returnDate": "2021-04-03T08:03:40.000Z", "loanPolicyId": "c33e4b9f-0937-4d29-a848-cfa3e446bd04", "lostItemPolicyId": "be4173d0-fbf4-4bfa-9458-fa8fbd34ed7a", "systemReturnDate": "2021-04-03T00:03:02.406+00:00", "overdueFinePolicyId": "3cbc29f2-0e55-4499-a3a7-06de026ba75d", "checkinServicePointId": "db6e8279-42c4-4876-8cf2-1c2fab56f02c", "checkoutServicePointId": "3a40852d-49fd-4df2-a1f9-6e2641a6e91f", "patronGroupIdAtCheckout": "1d65b61d-6dba-4769-bb7e-651a874f7004", "itemEffectiveLocationIdAtCheckOut": "6f016e6b-cdd9-4047-b941-90515af8636c"}

{"id": "0bab56e5-1ab6-4ac2-afdf-8b2df0434378", "action": "checkedin", "itemId": "459afaba-5b39-468d-9072-eb1685e0ddf4", "status": {"name": "Closed"}, "userId": "ab579dc3-219b-4f5b-8068-ab1c7a55c402", "dueDate": "2017-02-17T08:43:15.000+00:00", "loanDate": "2017-02-03T08:43:15Z", "metadata": {"createdDate": "2020-12-10T02:00:40.472", "updatedDate": "2020-12-10T02:00:40.472+00:00"}, "itemStatus": "Available", "returnDate": "2017-03-01T11:35:12Z", "proxyUserId": "a13dda6b-51ce-4543-be9c-eff894c0c2d0", "renewalCount": 0}

书籍的ID为jsonb下面的itemID
用户的ID为jsonb下面的userID

需要先清洗数据
留下jsonb的action为checkedout的条目，清洗后为"checkedout"sheet，有14550条条目
留下jsonb的action为checkedin的条目，清洗后为"checkedin"sheet，有278046条条目

## 版本1：基于物品的协同过滤
https://colab.research.google.com/drive/1kPYkHyxQQVt46DEhvK2B6-S8sh6PQh_J?usp=sharing

对用户"4a7c1ceb-0e26-4a24-ad4f-f782587cb49f"推荐：
该用户喜欢日文书籍，三本借阅历史全都是日文小说
3b1af95b-b843-4ad1-b2d7-b6475f042241
c0124dd3-1c3f-4912-8695-d5a793bf3ec5
867203d9-ab49-4cc4-8ac8-a33f582e2c0b 《眠》
[('732973eb-3bc1-4516-8383-1b1145f4ba50', 0.7071067811865475), ('457a0812-0795-4dc7-ad65-e1d4b525f4ab', 0.7071067811865475), ('bca3d62b-a8d3-4e1a-a8cc-996c9161919a', 0.7071067811865475), ('f8dce366-ec13-404d-b14e-9ca0bb20be1f', 0.7071067811865475)]

获取书名的方式：
http://162.105.134.104/circulation-log?itemBarcode=3b1af95b-b843-4ad1-b2d7-b6475f042241

这个版本推荐效果不佳，两本书同时被越多的用户借阅过，两本书就越相似，但是两本书同时出现的次数，大部分为0，少量为1

<!-- {"id": "848167c7-d7b6-4829-9839-0854c2eff132", "action": "checkedin", "itemId": "867203d9-ab49-4cc4-8ac8-a33f582e2c0b", "status": {"name": "Closed"}, "userId": "5c55422b-0ece-49de-a2ae-15f32dbd571d", "dueDate": "2021-04-13T15:59:00.000+00:00", "loanDate": "2021-03-13T13:55:35Z", "metadata": {"createdDate": "2021-03-13T22:20:22.002", "updatedDate": "2021-04-03T00:03:02.922+00:00", "createdByUserId": "7069a7b0-36e7-4f9d-bc42-2d0640ab268d", "updatedByUserId": "071e6b81-5b8f-4130-a5c2-98840953eb6c"}, "itemStatus": "Available", "returnDate": "2021-04-03T08:03:40.000Z", "loanPolicyId": "c33e4b9f-0937-4d29-a848-cfa3e446bd04", "lostItemPolicyId": "be4173d0-fbf4-4bfa-9458-fa8fbd34ed7a", "systemReturnDate": "2021-04-03T00:03:02.406+00:00", "overdueFinePolicyId": "3cbc29f2-0e55-4499-a3a7-06de026ba75d", "checkinServicePointId": "db6e8279-42c4-4876-8cf2-1c2fab56f02c", "checkoutServicePointId": "3a40852d-49fd-4df2-a1f9-6e2641a6e91f", "patronGroupIdAtCheckout": "1d65b61d-6dba-4769-bb7e-651a874f7004", "itemEffectiveLocationIdAtCheckOut": "6f016e6b-cdd9-4047-b941-90515af8636c"}
另一个用户借阅过《眠》

{"id": "72f93137-fe88-408c-b44c-7b538fb63e69", "action": "checkedin", "itemId": "dfe33775-0843-48fc-aa49-71ace89a8621", "status": {"name": "Closed"}, "userId": "5c55422b-0ece-49de-a2ae-15f32dbd571d", "dueDate": "2021-04-07T15:59:00.000+00:00", "loanDate": "2021-03-07T09:06:33Z", "metadata": {"createdDate": "2021-03-07T22:19:00.735", "updatedDate": "2021-04-03T00:02:47.750+00:00", "createdByUserId": "7069a7b0-36e7-4f9d-bc42-2d0640ab268d", "updatedByUserId": "071e6b81-5b8f-4130-a5c2-98840953eb6c"}, "itemStatus": "Available", "returnDate": "2021-04-03T08:03:25.000Z", "loanPolicyId": "c33e4b9f-0937-4d29-a848-cfa3e446bd04", "lostItemPolicyId": "be4173d0-fbf4-4bfa-9458-fa8fbd34ed7a", "systemReturnDate": "2021-04-03T00:02:47.228+00:00", "overdueFinePolicyId": "3cbc29f2-0e55-4499-a3a7-06de026ba75d", "checkinServicePointId": "db6e8279-42c4-4876-8cf2-1c2fab56f02c", "checkoutServicePointId": "3a40852d-49fd-4df2-a1f9-6e2641a6e91f", "patronGroupIdAtCheckout": "1d65b61d-6dba-4769-bb7e-651a874f7004", "itemEffectiveLocationIdAtCheckOut": "6f016e6b-cdd9-4047-b941-90515af8636c"}
他还借阅了《绝唱》（日），按道理应该推荐这本给用户 -->